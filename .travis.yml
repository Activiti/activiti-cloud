import: Activiti/activiti-scripts:.travis.java.yml@develop
install: travis_wait mvn ${MAVEN_CLI_OPTS} dependency:resolve dependency:resolve-plugins
  || true
stages:
- name: activiti-cloud-build
- name: activiti-cloud-api
- name: activiti-cloud-service-common
- name: activiti-cloud-acceptance-tests
- name: activiti-cloud-runtime-bundle-service
- name: activiti-cloud-messages-service
- name: activiti-cloud-query-service
- name: activiti-cloud-audit-service
- name: activiti-cloud-modeling-service
- name: activiti-cloud-notifications-graphql-service
- name: activiti-cloud-connectors
- name: deploy
  if: type != pull_request
- name: tag
  if: type != pull_request
- name: updatebot
  if: type != pull_request
jobs:
  include:
  - name: activiti-cloud-build
    stage: activiti-cloud-build
    script:
    - travis_wait 120 ${MAVEN_CMD} -f activiti-cloud-build/pom.xml
  - name: activiti-cloud-api
    stage: activiti-cloud-api
    script:
    - travis_wait 120 ${MAVEN_CMD} -f activiti-cloud-api/pom.xml
  - name: activiti-cloud-service-common
    stage: activiti-cloud-service-common
    script:
    - travis_wait 120 ${MAVEN_CMD} -f activiti-cloud-service-common/pom.xml
  - name: activiti-cloud-acceptance-tests
    stage: activiti-cloud-acceptance-tests
    script:
    - travis_wait 120 ${MAVEN_CMD} -f activiti-cloud-acceptance-tests/pom.xml
  - name: activiti-cloud-runtime-bundle-service
    stage: activiti-cloud-runtime-bundle-service
    script:
    - travis_wait 120 ${MAVEN_CMD} -f activiti-cloud-runtime-bundle-service/pom.xml
  - name: activiti-cloud-messages-service
    stage: activiti-cloud-messages-service
    script:
    - travis_wait 120 ${MAVEN_CMD} -f activiti-cloud-messages-service/pom.xml
  - name: activiti-cloud-query-service
    stage: activiti-cloud-query-service
    script:
    - travis_wait 120 ${MAVEN_CMD} -f activiti-cloud-query-service/pom.xml
  - name: activiti-cloud-audit-service
    stage: activiti-cloud-audit-service
    script:
    - travis_wait 120 ${MAVEN_CMD} -f activiti-cloud-audit-service/pom.xml
  - name: activiti-cloud-modeling-service
    stage: activiti-cloud-modeling-service
    script:
    - travis_wait 120 ${MAVEN_CMD} -f activiti-cloud-modeling-service/pom.xml
  - name: activiti-cloud-notifications-graphql-service
    stage: activiti-cloud-notifications-graphql-service
    script:
    - travis_wait 120 ${MAVEN_CMD} -f activiti-cloud-notifications-graphql-service/pom.xml
  - name: activiti-cloud-connectors
    stage: activiti-cloud-connectors
    script:
    - travis_wait 120 ${MAVEN_CMD} -f activiti-cloud-connectors/pom.xml
  - name: deploy
    stage: deploy
    script:
    - 
  - name: Create a tag
    stage: tag
    script: |
      mvn versions:set -DnewVersion=$(cat VERSION)
      git add --all
      git commit -m "Release $(cat VERSION)" --allow-empty
      git tag -fa v$(cat VERSION) -m "Release version $(cat VERSION)"
      git push -f -q https://${GITHUB_TOKEN}@github.com/Activiti/activiti-cloud.git v$(cat VERSION)
  - name: Deploy to nexus
    stage: deploy
    script:
    - mvn versions:set -DnewVersion=$(cat VERSION)
    - mvn clean deploy -DskipTests
  - name: Update versions in other components
    stage: updatebot
    script:
    - export VERSION=$(cat VERSION)| make updatebot/push-version
env:
  global:
    secure: iBa+89kVMvbcPg4y2DmYRPkKqacKznE53QipmHTHdnhc4dP1CQRYCmg35T2o7GOYKuBQ3b/S6vdDgLek7cB7f1BuqDmJ83w6kKMs/DqZjOxs1ZXYS5pK25mobLLXtxsnAV4S8twl5GjbsNgv7rWFVVqOlNk0emVu0xkGC4pc8HfHhoHIuB4HpFLW2Xvsk8LXOfBoLSbQGWTLUGC9ia7+usj3oPYfD11TKWO29IAUVi134UsXiKnFZauJuSC5stG1k53VWqYhN/tPxXhtlKl9GWtb3rKezr5ZquCEtssWzYUsKU3jOomD9gPTdkl+w9UV6zy2QxlAbB9N+qZ95ybX9PydAs+xB+801eIb9fyy6HjjZh1oO1JR2vKng62sOWN9t9Pt10vN3ZDrDp0J/b/iRACM4j6YzzHTzUlUjTZjZ7Kkqfo5vIvxqYecm6VcLS4hXcKNbeBFtPP6VtciECbum2T3pMhSf2F/LBHjPhNORrWu67iE31RNnyetBDLbok+qH4p+S9T5CIbYor5t8Eei1HNPgkBvUGCtr93WRsqGHuekkTSxSYOf5UyP/p3r7UdsnTvqht+iqZKY+uGdg6/MUwLOQOYgg3CJOnoFIDOgRe2cLQ4gYZCnA/YeByyST8xYzGOAtQ8ebkvRpUUZn8q53N/Keeq/twtVVwq5agToMSA=
